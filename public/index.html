<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Радио</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        body {
            position: relative;
            color: white;
            text-align: center;
        }

        #background {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.6;
            animation: float 20s infinite ease-in-out;
        }

        @keyframes float {
            0% {
                transform: translateY(0) translateX(0);
            }
            50% {
                transform: translateY(-50px) translateX(50px);
            }
            100% {
                transform: translateY(0) translateX(0);
            }
        }

        .content {
            position: relative;
            z-index: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        h1 {
            font-size: 36px;
            margin: 0;
        }

        p, button {
            margin: 20px auto;
            font-size: 16px;
        }

        button {
            padding: 10px 20px;
            cursor: pointer;
        }

        #start-radio {
            font-size: 20px;
            padding: 10px 30px;
        }

        #like {
            background-color: gray;
            border: none;
            color: white;
            transition: background-color 0.3s;
        }

        #like.liked {
            background-color: green;
        }

        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            text-align: left;
            font-size: 14px;
            z-index: 2;
        }

        #queue {
            position: absolute;
            top: 10px;
            right: 10px;
            text-align: right;
            font-size: 14px;
            z-index: 2;
        }

        #queue ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #queue li {
            color: inherit;
            transition: color 0.3s;
        }

        audio {
            display: none;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 24px;
            }

            #info, #queue {
                font-size: 12px;
            }

            button {
                padding: 8px 16px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div id="background"></div>

    <div id="info">
        <div id="online">В сети: 0</div>
        <div id="likes">Нравится пользователям: 0</div>
    </div>

    <div id="queue">
        <div>Очередь:</div>
        <ul id="track-queue"></ul>
    </div>

    <div class="content">
        <h1>Random Радио</h1>
        <p id="track">Текущий трек: ---</p>
        <button id="start-radio">Запустить радио</button>
        <button id="like">Лайк</button>
        <audio id="audio" autoplay></audio>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const audio = document.getElementById('audio');
        const track = document.getElementById('track');
        const online = document.getElementById('online');
        const likes = document.getElementById('likes');
        const likeButton = document.getElementById('like');
        const startRadioButton = document.getElementById('start-radio');
        const trackQueue = document.getElementById('track-queue');

        const background = document.getElementById('background');

        // Автоматический запуск радио
        function startRadio() {
            startRadioButton.style.display = 'none';
            audio.play();
        }

        startRadioButton.addEventListener('click', startRadio);

        let lastTrack = null;

        socket.on('track-info', ({ track: trackName, likes: trackLikes, elapsed, serverTime, queue }) => {
            const clientTime = Date.now();
            const latency = (clientTime - serverTime) / 2;
            const adjustedElapsed = elapsed + latency / 1000;

            if (lastTrack !== trackName) {
                lastTrack = trackName;
                audio.src = '/stream';
                audio.currentTime = adjustedElapsed;
                audio.play();

                likeButton.classList.remove('liked');
                likeButton.disabled = false;

                const color = getRandomColor();
                applyGradient(color);
                createBlobs(color);
            }

            track.textContent = `Текущий трек: ${trackName}`;
            likes.textContent = `Нравится пользователям: ${trackLikes}`;

            // Обновляем очередь (5 треков)
            trackQueue.innerHTML = queue.slice(0, 5).map(q => `<li>${q}</li>`).join('');
        });

        // Онлайн
        socket.on('online', (count) => {
            online.textContent = `В сети: ${count}`;
        });

        // Лайк
        likeButton.addEventListener('click', () => {
            socket.emit('like');
            likeButton.disabled = true;
            likeButton.classList.add('liked');
        });

        // Получить случайный цвет
        function getRandomColor() {
            const r = Math.floor(Math.random() * 256);
            const g = Math.floor(Math.random() * 256);
            const b = Math.floor(Math.random() * 256);
            return { r, g, b };
        }

        // Применить градиент
        function applyGradient({ r, g, b }) {
            document.body.style.background = `linear-gradient(120deg, rgb(${r}, ${g}, ${b}) 0%, rgb(${r - 30}, ${g - 30}, ${b - 30}) 100%)`;
        }

        // Создание цветных шаров
        function createBlobs(baseColor) {
            background.innerHTML = ''; // очистить старые

            for (let i = 0; i < 4; i++) {
                const blob = document.createElement('div');
                blob.classList.add('blob');

                const size = Math.floor(Math.random() * 200) + 100;
                const r = Math.min(255, baseColor.r + (Math.random() * 100 - 50));
                const g = Math.min(255, baseColor.g + (Math.random() * 100 - 50));
                const b = Math.min(255, baseColor.b + (Math.random() * 100 - 50));
                blob.style.background = `rgb(${r}, ${g}, ${b})`;
                blob.style.width = blob.style.height = `${size}px`;
                blob.style.top = `${Math.random() * 100}%`;
                blob.style.left = `${Math.random() * 100}%`;
                background.appendChild(blob);
            }
        }

        window.onload = function () {
            const color = getRandomColor();
            applyGradient(color);
            createBlobs(color);
        };
    </script>
</body>
</html>
